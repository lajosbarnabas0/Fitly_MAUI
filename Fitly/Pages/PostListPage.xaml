<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Fitly.Pages.PostListPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:Fitly.Models"
    xmlns:tool="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
    xmlns:viewmodels="clr-namespace:Fitly.ViewModels"
    x:DataType="viewmodels:PostListViewModel"
    BackgroundColor="{x:StaticResource fitly_darkgray}"
    Loaded="ContentPage_Loaded"
    Shell.NavBarIsVisible="False">

    <ContentPage.Behaviors>
        <tool:EventToCommandBehavior Command="{Binding AppearingCommand}" EventName="Appearing" />
    </ContentPage.Behaviors>

    <ContentPage.BindingContext>
        <viewmodels:PostListViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="0.2*,1.5*">
        <Border HorizontalOptions="Center" Stroke="{x:StaticResource fitly_darkgray}">
            <StackLayout Orientation="Horizontal">
                <Image Source="expand_more_24.png" WidthRequest="50" />
                <Label
                    FontSize="25"
                    HorizontalOptions="Center"
                    Text="Menü"
                    TextColor="White"
                    VerticalOptions="Center" />
            </StackLayout>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Tapped="NavMenu_Tapped" />
            </Border.GestureRecognizers>
        </Border>

        <Grid Grid.Row="1" RowDefinitions="0.2*,1.6*">
            <Label
                Grid.Row="0"
                Margin="15"
                FontSize="24"
                Text="Bejegyzések"
                TextColor="White" />
            <CollectionView
                Grid.Row="1"
                HorizontalOptions="Fill"
                ItemsSource="{Binding Posts}"
                SelectedItem="{Binding SelectedPost}"
                VerticalOptions="Fill">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Post">
                        <Border
                            Margin="10"
                            Padding="10"
                            BackgroundColor="{x:StaticResource Gray900}"
                            MinimumHeightRequest="250"
                            Stroke="{x:StaticResource Gray900}"
                            StrokeShape="RoundRectangle 20">
                            <Grid RowDefinitions="*,*,*,*,*">
                                <Border
                                    Grid.Row="0"
                                    Margin="0,0,0,10"
                                    BackgroundColor="{x:StaticResource Gray700}"
                                    Stroke="{x:StaticResource Gray700}"
                                    StrokeShape="RoundRectangle 15">
                                    <StackLayout Orientation="Horizontal">
                                        <Label
                                            x:Name="title_LBL"
                                            Grid.Row="0"
                                            Padding="7"
                                            FontSize="16"
                                            LineBreakMode="WordWrap"
                                            Text="{Binding Title}"
                                            TextColor="White"
                                            VerticalTextAlignment="Start" />

                                        <Label
                                            x:Name="author_LBL"
                                            Grid.Row="1"
                                            Padding="7"
                                            FontSize="14"
                                            HorizontalOptions="EndAndExpand"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding Author}"
                                            TextColor="LightGray"
                                            VerticalTextAlignment="End" />

                                    </StackLayout>

                                </Border>
                                <Border
                                    Grid.Row="1"
                                    Grid.RowSpan="3"
                                    BackgroundColor="{x:StaticResource Gray700}"
                                    HorizontalOptions="Fill"
                                    Stroke="{x:StaticResource Gray700}"
                                    StrokeShape="RoundRectangle 15"
                                    VerticalOptions="Fill">
                                    <Label
                                        x:Name="description_LBL"
                                        Padding="7"
                                        FontSize="14"
                                        HorizontalOptions="StartAndExpand"
                                        HorizontalTextAlignment="Start"
                                        LineBreakMode="CharacterWrap"
                                        Text="{Binding Content}"
                                        TextColor="LightGray"
                                        VerticalOptions="Start"
                                        VerticalTextAlignment="Start" />
                                </Border>

                                <Button
                                    Grid.Row="4"
                                    Margin="5"
                                    BackgroundColor="{x:StaticResource fitly_darkgreen}"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DetailButtonPressedCommand}"
                                    CommandParameter="{Binding .}"
                                    HorizontalOptions="CenterAndExpand"
                                    Text="További részletek"
                                    VerticalOptions="CenterAndExpand" />


                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>